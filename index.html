<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherSnap - Previs√£o do Tempo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Anima√ß√µes personalizadas */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-400 to-blue-600 min-h-screen text-white font-sans transition-colors duration-700" id="body-bg">

    <div class="container mx-auto px-4 py-8 max-w-md">
        
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold flex items-center gap-2">
                WeatherSnap <i data-lucide="sun" class="text-yellow-300 fill-yellow-300"></i>
            </h1>
            <span class="bg-white/20 px-3 py-1 rounded-full text-xs font-medium">v1.0</span>
        </header>

        <div class="relative mb-6">
            <input type="text" id="city-input" placeholder="Buscar cidade..." 
                class="w-full py-3 px-5 rounded-xl bg-white/20 placeholder-white/70 text-white outline-none focus:bg-white/30 transition shadow-lg border border-transparent focus:border-white/40">
            <button id="search-btn" class="absolute right-2 top-1.5 bg-white/30 p-1.5 rounded-lg hover:bg-white/50 transition">
                <i data-lucide="search" class="w-5 h-5"></i>
            </button>
        </div>

        <div id="weather-card" class="glass rounded-3xl p-6 text-center shadow-xl mb-6 hidden">
            
            <div class="flex justify-between items-start mb-4">
                <div class="text-left">
                    <h2 class="text-2xl font-bold" id="city-name">--</h2>
                    <p class="text-sm opacity-90 capitalize" id="current-date">--</p>
                </div>
                <div class="flex gap-2">
                    <button class="p-2 rounded-full bg-white/10 hover:bg-white/20 transition"><i data-lucide="share-2" class="w-4 h-4"></i></button>
                </div>
            </div>

            <div class="flex flex-col items-center justify-center my-6">
                <div id="weather-icon-container" class="animate-float mb-2">
                    <i data-lucide="cloud" class="w-20 h-20 text-white"></i>
                </div>
                <h1 class="text-6xl font-bold tracking-tighter" id="temperature">--¬∞C</h1>
                <p class="text-xl font-medium mt-2 capitalize" id="description">--</p>
            </div>

            <div class="flex justify-center gap-6 text-sm opacity-90 mb-6">
                <div class="flex items-center gap-1">
                    <i data-lucide="wind" class="w-4 h-4"></i> <span id="wind-speed">-- km/h</span>
                </div>
                <div class="flex items-center gap-1">
                    <i data-lucide="droplets" class="w-4 h-4"></i> <span id="humidity">--%</span>
                </div>
            </div>

            <div class="bg-white/20 rounded-xl p-3 text-sm font-medium">
                <p id="suggestion-text">Carregando sugest√£o...</p>
            </div>
        </div>

        <div id="forecast-container" class="hidden">
            <h3 class="text-lg font-semibold mb-3 ml-1">Pr√≥ximos dias</h3>
            <div class="grid grid-cols-3 gap-3" id="forecast-grid">
                </div>
        </div>
        
        <div id="loading-msg" class="text-center mt-20 opacity-70">
            Digite uma cidade para come√ßar...
        </div>

    </div>

    <script>
        // Elementos do DOM
        const input = document.getElementById('city-input');
        const btn = document.getElementById('search-btn');
        const weatherCard = document.getElementById('weather-card');
        const forecastContainer = document.getElementById('forecast-container');
        const loadingMsg = document.getElementById('loading-msg');
        const bodyBg = document.getElementById('body-bg');

        // Configura√ß√£o da API Open-Meteo
        // 1. Geocoding API para pegar Lat/Lon da cidade
        // 2. Forecast API para pegar o clima usando Lat/Lon

        async function fetchWeather(city) {
            try {
                loadingMsg.innerText = "Buscando dados clim√°ticos...";
                loadingMsg.classList.remove('hidden');
                weatherCard.classList.add('hidden');
                forecastContainer.classList.add('hidden');

                // Passo 1: Geocodifica√ß√£o
                const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=pt&format=json`;
                const geoRes = await fetch(geoUrl);
                const geoData = await geoRes.json();

                if (!geoData.results) {
                    throw new Error("Cidade n√£o encontrada");
                }

                const { latitude, longitude, name, admin1 } = geoData.results[0];

                // Passo 2: Previs√£o do Tempo
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,is_day,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`;
                
                const weatherRes = await fetch(weatherUrl);
                const weatherData = await weatherRes.json();

                updateUI(name, admin1, weatherData);

            } catch (error) {
                loadingMsg.innerText = "Erro: " + error.message;
                console.error(error);
            }
        }

        function updateUI(city, state, data) {
            const current = data.current;
            const daily = data.daily;
            
            // Atualizar Card Principal
            document.getElementById('city-name').innerText = `${city}, ${state || ''}`;
            
            // Formatar data atual
            const date = new Date();
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('current-date').innerText = date.toLocaleDateString('pt-BR', options);

            document.getElementById('temperature').innerText = `${Math.round(current.temperature_2m)}¬∞C`;
            document.getElementById('wind-speed').innerText = `${current.wind_speed_10m} km/h`;
            document.getElementById('humidity').innerText = `${current.relative_humidity_2m}%`;

            // L√≥gica do C√≥digo WMO (Traduzir c√≥digo num√©rico para texto e √≠cone)
            const weatherInfo = getWeatherInfo(current.weather_code);
            document.getElementById('description').innerText = weatherInfo.label;
            document.getElementById('weather-icon-container').innerHTML = `<i data-lucide="${weatherInfo.icon}" class="w-20 h-20 text-white"></i>`;

            // Sugest√£o Inteligente
            document.getElementById('suggestion-text').innerHTML = `${getSuggestion(current.weather_code, current.temperature_2m)} ${weatherInfo.emoji}`;

            // Tema Din√¢mico (Mudar gradiente do fundo)
            updateTheme(current.is_day, current.weather_code);

            // Renderizar Previs√£o (Pr√≥ximos 3 dias)
            const forecastGrid = document.getElementById('forecast-grid');
            forecastGrid.innerHTML = ''; // Limpar anterior

            for(let i = 1; i <= 3; i++) {
                const dayCode = daily.weather_code[i];
                const maxTemp = Math.round(daily.temperature_2m_max[i]);
                const dayInfo = getWeatherInfo(dayCode);
                
                // Pegar nome do dia da semana
                const nextDate = new Date();
                nextDate.setDate(date.getDate() + i);
                const dayName = nextDate.toLocaleDateString('pt-BR', { weekday: 'short' });

                const cardHtml = `
                    <div class="glass rounded-xl p-3 flex flex-col items-center justify-center">
                        <span class="text-sm font-semibold capitalize opacity-80">${dayName}.</span>
                        <div class="my-2">
                             <i data-lucide="${dayInfo.icon}" class="w-8 h-8 text-white"></i>
                        </div>
                        <span class="text-lg font-bold">${maxTemp}¬∞C</span>
                    </div>
                `;
                forecastGrid.innerHTML += cardHtml;
            }

            // Mostrar tudo e atualizar √≠cones
            loadingMsg.classList.add('hidden');
            weatherCard.classList.remove('hidden');
            forecastContainer.classList.remove('hidden');
            lucide.createIcons();
        }

        // --- Fun√ß√µes Auxiliares de L√≥gica ---

        function getWeatherInfo(code) {
            // Mapeamento simplificado dos c√≥digos WMO da Open-Meteo
            if (code === 0) return { label: 'C√©u Limpo', icon: 'sun', emoji: 'üòé' };
            if (code >= 1 && code <= 3) return { label: 'Nublado', icon: 'cloud', emoji: '‚òÅÔ∏è' };
            if (code >= 45 && code <= 48) return { label: 'Neblina', icon: 'cloud-fog', emoji: 'üå´Ô∏è' };
            if (code >= 51 && code <= 67) return { label: 'Chuva', icon: 'cloud-rain', emoji: '‚òî' };
            if (code >= 71 && code <= 77) return { label: 'Neve', icon: 'snowflake', emoji: '‚õÑ' };
            if (code >= 80 && code <= 82) return { label: 'Chuva Forte', icon: 'cloud-drizzle', emoji: 'üåßÔ∏è' };
            if (code >= 95) return { label: 'Tempestade', icon: 'cloud-lightning', emoji: '‚õàÔ∏è' };
            return { label: 'Indefinido', icon: 'cloud', emoji: 'üòê' };
        }

        function getSuggestion(code, temp) {
            if (code >= 95) return "Fique em casa! Perigo de raios.";
            if (code >= 51 && code <= 67) return "N√£o esque√ßa o guarda-chuva se for sair.";
            if (temp > 30) return "Beba muita √°gua e use protetor solar!";
            if (temp < 15) return "Tempo perfeito para um caf√© quente.";
            if (code === 0) return "√ìtimo dia para passear no parque.";
            return "Aproveite o seu dia com tranquilidade.";
        }

        function updateTheme(isDay, code) {
            // Remove classes antigas
            bodyBg.className = "min-h-screen text-white font-sans transition-colors duration-700 bg-gradient-to-br";

            if (isDay === 0) {
                // Noite
                bodyBg.classList.add("from-gray-900", "to-blue-900");
            } else {
                // Dia - Depende do clima
                if (code >= 51 || code >= 95) { // Chuva ou tempestade
                    bodyBg.classList.add("from-slate-600", "to-slate-800");
                } else if (code >= 1 && code <= 3) { // Nublado
                    bodyBg.classList.add("from-blue-300", "to-blue-500");
                } else { // Sol
                    bodyBg.classList.add("from-blue-400", "to-cyan-400");
                }
            }
        }

        // Event Listeners
        btn.addEventListener('click', () => {
            if(input.value) fetchWeather(input.value);
        });

        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && input.value) fetchWeather(input.value);
        });

        // Inicializar √≠cones
        lucide.createIcons();
    </script>
</body>
</html>